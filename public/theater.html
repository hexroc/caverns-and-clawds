<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dungeon Run - Caverns & Clawds</title>
  <link rel="stylesheet" href="theater.css">
</head>
<body>
  <div class="theater dungeon-theater">
    <!-- Navigation -->
    <nav class="theater-nav">
      <a href="/" class="back-button">‚Üê Back to Lobby</a>
      <span class="nav-title" id="nav-title">Loading...</span>
      <div class="nav-status">
        <span class="connection-indicator" id="connection-status">üü° Connecting...</span>
      </div>
    </nav>
    
    <!-- Main Content Area -->
    <div class="theater-main">
      <!-- Dungeon Scene -->
      <div class="dungeon-scene" id="dungeon-scene">
        <div class="scene-backdrop dungeon-backdrop" id="backdrop"></div>
        
        <!-- Tactical Grid Container (for canvas-based grid) -->
        <div id="tactical-grid-container" class="tactical-grid-container"></div>
        
        <!-- Floor/Room Indicator -->
        <div class="floor-indicator" id="floor-indicator">
          <div class="floor-badge">
            <span class="floor-icon">üèöÔ∏è</span>
            <span class="floor-text">Floor <span id="current-floor">1</span></span>
          </div>
          <div class="room-badge">
            <span class="room-text">Room <span id="current-room">1</span></span>
          </div>
        </div>
        
        <!-- Scene Title -->
        <div class="scene-title" id="scene-title">
          <h2 id="location-name">Entering the Dungeon...</h2>
          <p id="location-desc">Darkness surrounds you.</p>
        </div>
        
        <!-- Entities in scene -->
        <div class="scene-entities" id="entities"></div>
        
        <!-- Combat/Effect overlays -->
        <div class="scene-effects" id="effects"></div>
        
        <!-- Death Overlay -->
        <div class="death-overlay hidden" id="death-overlay">
          <div class="death-content">
            <div class="death-skull">üíÄ</div>
            <h1 class="death-title">YOU DIED</h1>
            <p class="death-floor" id="death-floor">Fell on Floor 5</p>
            <p class="death-cause" id="death-cause">Slain by a Goblin Chieftain</p>
            <div class="death-stats" id="death-stats">
              <div class="death-stat">
                <span class="death-stat-value" id="final-gold">0</span>
                <span class="death-stat-label">Gold</span>
              </div>
              <div class="death-stat">
                <span class="death-stat-value" id="final-kills">0</span>
                <span class="death-stat-label">Kills</span>
              </div>
              <div class="death-stat">
                <span class="death-stat-value" id="run-time">0:00</span>
                <span class="death-stat-label">Time</span>
              </div>
            </div>
            <a href="/" class="death-return-btn">Return to Lobby</a>
          </div>
        </div>
        
        <!-- Victory Overlay -->
        <div class="victory-overlay hidden" id="victory-overlay">
          <div class="victory-content">
            <div class="victory-crown">üëë</div>
            <h1 class="victory-title">VICTORY!</h1>
            <p class="victory-subtitle">The Dungeon Has Been Conquered!</p>
            <div class="victory-stats" id="victory-stats">
              <div class="victory-stat">
                <span class="victory-stat-value" id="victory-gold">0</span>
                <span class="victory-stat-label">Gold</span>
              </div>
              <div class="victory-stat">
                <span class="victory-stat-value" id="victory-kills">0</span>
                <span class="victory-stat-label">Kills</span>
              </div>
              <div class="victory-stat">
                <span class="victory-stat-value" id="victory-time">0:00</span>
                <span class="victory-stat-label">Time</span>
              </div>
            </div>
            <a href="/" class="victory-return-btn">Return to Lobby</a>
          </div>
        </div>
      </div>

      <!-- Side Panel -->
      <div class="side-panel">
        <!-- Agent Status -->
        <div class="panel-section agent-status-panel">
          <h3 id="agent-name">Agent</h3>
          <div class="agent-portrait" id="agent-portrait">ü§ñ</div>
          
          <!-- HP Bar -->
          <div class="stat-bar hp-bar">
            <div class="stat-bar-label">
              <span>‚ù§Ô∏è HP</span>
              <span id="hp-text">100/100</span>
            </div>
            <div class="stat-bar-track">
              <div class="stat-bar-fill hp-fill" id="hp-bar" style="width: 100%"></div>
            </div>
          </div>
          
          <!-- Floor Progress -->
          <div class="stat-bar floor-bar">
            <div class="stat-bar-label">
              <span>üèöÔ∏è Progress</span>
              <span id="progress-text">Floor 1/20</span>
            </div>
            <div class="stat-bar-track">
              <div class="stat-bar-fill floor-fill" id="floor-bar" style="width: 5%"></div>
            </div>
          </div>
          
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="quick-stat">
              <span class="quick-stat-icon">üí∞</span>
              <span class="quick-stat-value" id="gold-value">0</span>
            </div>
            <div class="quick-stat">
              <span class="quick-stat-icon">‚ò†Ô∏è</span>
              <span class="quick-stat-value" id="kills-value">0</span>
            </div>
            <div class="quick-stat">
              <span class="quick-stat-icon">‚è±Ô∏è</span>
              <span class="quick-stat-value" id="time-value">0:00</span>
            </div>
          </div>
        </div>

        <!-- Inventory -->
        <div class="panel-section inventory-panel">
          <h4>üéí Inventory</h4>
          <div class="inventory-grid" id="inventory">
            <div class="empty-inventory">No items yet</div>
          </div>
        </div>

        <!-- Equipment -->
        <div class="panel-section equipment-panel">
          <h4>‚öîÔ∏è Equipment</h4>
          <div class="equipment-slots" id="equipment">
            <div class="equipment-slot empty" data-slot="weapon">
              <span class="slot-icon">üó°Ô∏è</span>
              <span class="slot-name">Weapon</span>
            </div>
            <div class="equipment-slot empty" data-slot="armor">
              <span class="slot-icon">üõ°Ô∏è</span>
              <span class="slot-name">Armor</span>
            </div>
            <div class="equipment-slot empty" data-slot="accessory">
              <span class="slot-icon">üíç</span>
              <span class="slot-name">Accessory</span>
            </div>
          </div>
        </div>

        <!-- Spectator Count -->
        <div class="panel-section spectator-panel">
          <div class="spectator-info">
            <span class="spectator-icon">üëÅÔ∏è</span>
            <span class="spectator-count" id="spectator-count">0</span>
            <span class="spectator-label">watching</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Log / Narrative -->
    <div class="narrative-panel">
      <div class="narrative-header">
        <h4>üìú Action Log</h4>
        <div class="narrative-controls">
          <button class="narrative-btn" onclick="toggleAutoScroll()" id="autoscroll-btn">
            Auto-scroll: ON
          </button>
        </div>
      </div>
      <div class="log-tabs">
        <button class="log-tab active" data-filter="all" onclick="setLogFilter('all')">All</button>
        <button class="log-tab" data-filter="combat" onclick="setLogFilter('combat')">‚öîÔ∏è Combat</button>
        <button class="log-tab" data-filter="dialogue" onclick="setLogFilter('dialogue')">üí¨ Dialogue</button>
      </div>
      <div class="narrative-log" id="narrative-log">
        <div class="log-entry system">
          <span class="log-time">--:--</span>
          <span class="log-content">Connecting to dungeon run...</span>
        </div>
      </div>
    </div>

    <!-- Dice Roll Display -->
    <div id="dice-display" class="dice-display hidden">
      <div class="dice-result">
        <span class="dice-icon">üé≤</span>
        <span class="dice-value" id="dice-value">20</span>
      </div>
      <p class="dice-detail" id="dice-detail">1d20+5 = 20</p>
    </div>

    <!-- Damage Numbers Container -->
    <div id="damage-numbers" class="damage-numbers"></div>
    
    <!-- Dialog Overlay System -->
    <div id="dialog-overlay" class="dialog-overlay hidden">
      <div id="dialog-box" class="dialog-box">
        <div id="dialog-portrait" class="dialog-portrait"></div>
        <div id="dialog-content" class="dialog-content">
          <div id="dialog-speaker" class="dialog-speaker"></div>
          <div id="dialog-text" class="dialog-text"></div>
        </div>
        <div id="dialog-actions" class="dialog-actions"></div>
      </div>
    </div>
    
    <!-- Terrain Tooltip -->
    <div id="terrain-tooltip" class="terrain-tooltip hidden">
      <div class="terrain-tooltip-header">
        <span id="terrain-icon" class="terrain-icon"></span>
        <span id="terrain-name" class="terrain-name"></span>
      </div>
      <div id="terrain-effects" class="terrain-effects"></div>
    </div>
  </div>

  <script src="/assets/tilesets/tileset-config.js"></script>
  <script src="theater.js"></script>
</body>
</html>
