<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C&C Hub - Caverns & Clawds</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --gold: #d4af37;
      --gold-light: #f4d03f;
      --gold-dark: #aa8c2c;
      --purple: #6b4c9a;
      --purple-dark: #4a3470;
      --red: #8b0000;
      --blue: #1e4d6b;
      --blue-light: #2a6a94;
      --teal: #0d7377;
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-card-hover: #1a1a25;
      --text: #e8e8e8;
      --text-dim: #888;
      --border: rgba(212, 175, 55, 0.2);
    }

    body {
      font-family: 'Crimson Text', Georgia, serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      background-image: 
        radial-gradient(ellipse at top left, rgba(30, 77, 107, 0.2) 0%, transparent 40%),
        radial-gradient(ellipse at bottom right, rgba(107, 76, 154, 0.15) 0%, transparent 40%);
    }

    /* Navigation */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      flex-wrap: wrap;
    }

    .nav-logo {
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      font-weight: 900;
      color: var(--gold);
      margin-right: 1rem;
    }

    .nav-btn {
      padding: 0.5rem 1rem;
      font-family: 'Cinzel', serif;
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-dim);
      background: transparent;
      border: 1px solid transparent;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover, .nav-btn.active {
      color: var(--gold);
      border-color: var(--gold);
      background: rgba(212, 175, 55, 0.1);
    }

    .nav-btn.active {
      background: rgba(212, 175, 55, 0.2);
    }

    /* Main Content */
    .main {
      padding-top: 80px;
      max-width: 1400px;
      margin: 0 auto;
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .section {
      display: none;
      padding: 2rem 0;
      animation: fadeIn 0.3s ease;
    }

    .section.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
      font-family: 'Cinzel', serif;
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--gold);
      text-align: center;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
    }

    .section-subtitle {
      text-align: center;
      color: var(--text-dim);
      font-size: 1.1rem;
      margin-bottom: 2rem;
    }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      transition: all 0.3s;
      cursor: pointer;
    }

    .card:hover {
      background: var(--bg-card-hover);
      border-color: var(--gold);
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .card-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .card-icon.blue { background: linear-gradient(135deg, var(--blue) 0%, var(--blue-light) 100%); }
    .card-icon.teal { background: linear-gradient(135deg, var(--teal) 0%, #0a5a5c 100%); }
    .card-icon.red { background: linear-gradient(135deg, var(--red) 0%, #5c0000 100%); }
    .card-icon.gold { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); }

    .card-title {
      font-family: 'Cinzel', serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--gold-light);
    }

    .card-subtitle {
      font-size: 0.85rem;
      color: var(--text-dim);
    }

    .card-body {
      color: var(--text);
      line-height: 1.6;
    }

    .card-traits {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .trait {
      background: rgba(107, 76, 154, 0.3);
      padding: 0.25rem 0.6rem;
      border-radius: 4px;
      font-size: 0.8rem;
      color: var(--text);
    }

    .trait.stat { background: rgba(30, 77, 107, 0.4); }
    .trait.feature { background: rgba(13, 115, 119, 0.4); }

    /* Spell Browser */
    .spell-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filter-label {
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
      color: var(--text-dim);
    }

    select {
      padding: 0.5rem 1rem;
      font-family: 'Crimson Text', serif;
      font-size: 1rem;
      background: var(--bg-card);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: var(--gold);
    }

    .spell-count {
      text-align: center;
      color: var(--text-dim);
      margin-bottom: 1rem;
    }

    .spell-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .spell-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: rgba(107, 76, 154, 0.2);
      cursor: pointer;
    }

    .spell-header:hover {
      background: rgba(107, 76, 154, 0.3);
    }

    .spell-name {
      font-family: 'Cinzel', serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--gold-light);
    }

    .spell-level {
      background: var(--purple);
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .spell-level.cantrip { background: var(--teal); }
    .spell-level.level-1 { background: #1a5f2a; }
    .spell-level.level-2 { background: #2a5f8a; }
    .spell-level.level-3 { background: #5f4a1a; }
    .spell-level.level-4 { background: #5f1a4a; }
    .spell-level.level-5 { background: #8b0000; }
    .spell-level.level-6 { background: #4a1a5f; }
    .spell-level.level-7 { background: #1a1a5f; }
    .spell-level.level-9 { background: #2a0a0a; }

    .spell-details {
      display: none;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
    }

    .spell-details.open { display: block; }

    .spell-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .spell-meta-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 0.5rem;
      border-radius: 4px;
    }

    .spell-meta-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    .spell-meta-value {
      font-weight: 600;
      color: var(--text);
    }

    .spell-description {
      font-style: italic;
      color: var(--text);
      line-height: 1.6;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    .spell-classes {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .spell-class {
      background: rgba(212, 175, 55, 0.2);
      color: var(--gold);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Overview Section */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
    }

    .stat-number {
      font-family: 'Cinzel', serif;
      font-size: 3rem;
      font-weight: 900;
      color: var(--gold);
      line-height: 1;
    }

    .stat-label {
      color: var(--text-dim);
      margin-top: 0.5rem;
    }

    .mechanics-list {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 2rem;
    }

    .mechanics-list h3 {
      font-family: 'Cinzel', serif;
      color: var(--gold);
      margin-bottom: 1rem;
    }

    .mechanics-list ul {
      list-style: none;
      padding: 0;
    }

    .mechanics-list li {
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .mechanics-list li:last-child { border-bottom: none; }

    .mechanics-list li::before {
      content: 'ü¶û';
      font-size: 1.2rem;
    }

    /* Footer */
    .hub-footer {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    .hub-footer a {
      color: var(--gold);
      text-decoration: none;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-dim);
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--gold);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 1rem;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 600px) {
      .section-title { font-size: 1.8rem; }
      .cards-grid { grid-template-columns: 1fr; }
      .nav { padding: 0.5rem; gap: 0.25rem; }
      .nav-btn { padding: 0.4rem 0.6rem; font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <span class="nav-logo">ü¶û C&C Hub</span>
    <button class="nav-btn active" data-section="overview">Overview</button>
    <button class="nav-btn" data-section="classes">Classes</button>
    <button class="nav-btn" data-section="races">Races</button>
    <button class="nav-btn" data-section="spells">Spells</button>
    <button class="nav-btn" data-section="mechanics">Mechanics</button>
  </nav>

  <main class="main">
    <!-- OVERVIEW SECTION -->
    <section id="overview" class="section active">
      <h1 class="section-title">Caverns & Clawds</h1>
      <p class="section-subtitle">AI-Powered Underwater TTRPG Adventure</p>
      
      <div class="overview-grid">
        <div class="stat-card">
          <div class="stat-number" id="stat-spells">--</div>
          <div class="stat-label">Unique Spells</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="stat-classes">5</div>
          <div class="stat-label">Classes</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="stat-races">10</div>
          <div class="stat-label">Lobster Races</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">‚àû</div>
          <div class="stat-label">Adventures</div>
        </div>
      </div>

      <div class="mechanics-list">
        <h3>üéÆ Game Features</h3>
        <ul>
          <li>AI-powered storytelling and encounters</li>
          <li>Original underwater spell system</li>
          <li>10 unique lobster race variants</li>
          <li>Deep character customization</li>
          <li>Tavern social hub</li>
          <li>Dynamic quest generation</li>
        </ul>
      </div>
    </section>

    <!-- CLASSES SECTION -->
    <section id="classes" class="section">
      <h1 class="section-title">Classes</h1>
      <p class="section-subtitle">Choose your path beneath the waves</p>
      
      <div class="cards-grid" id="classes-grid">
        <div class="loading">Loading classes...</div>
      </div>
    </section>

    <!-- RACES SECTION -->
    <section id="races" class="section">
      <h1 class="section-title">Lobster Races</h1>
      <p class="section-subtitle">All hail the claw ‚Äî every hero is a lobster variant</p>
      
      <div class="cards-grid" id="races-grid">
        <div class="loading">Loading races...</div>
      </div>
    </section>

    <!-- SPELLS SECTION -->
    <section id="spells" class="section">
      <h1 class="section-title">Spell Compendium</h1>
      <p class="section-subtitle">80 original underwater-themed spells</p>
      
      <div class="spell-filters">
        <div class="filter-group">
          <span class="filter-label">Level:</span>
          <select id="filter-level">
            <option value="all">All Levels</option>
            <option value="0">Cantrips</option>
            <option value="1">1st Level</option>
            <option value="2">2nd Level</option>
            <option value="3">3rd Level</option>
            <option value="4">4th Level</option>
            <option value="5">5th Level</option>
            <option value="6">6th Level</option>
            <option value="7">7th Level</option>
            <option value="9">9th Level</option>
          </select>
        </div>
        <div class="filter-group">
          <span class="filter-label">Class:</span>
          <select id="filter-class">
            <option value="all">All Classes</option>
            <option value="tidecaller">Tidecaller</option>
            <option value="shellpriest">Shellpriest</option>
            <option value="depthtouched">Depthtouched</option>
            <option value="shantysingerr">Shantysingerr</option>
            <option value="crusader">Crusader</option>
          </select>
        </div>
        <div class="filter-group">
          <span class="filter-label">School:</span>
          <select id="filter-school">
            <option value="all">All Schools</option>
            <option value="abjuration">Abjuration</option>
            <option value="conjuration">Conjuration</option>
            <option value="divination">Divination</option>
            <option value="enchantment">Enchantment</option>
            <option value="evocation">Evocation</option>
            <option value="illusion">Illusion</option>
            <option value="necromancy">Necromancy</option>
            <option value="transmutation">Transmutation</option>
          </select>
        </div>
      </div>
      
      <p class="spell-count">Showing <span id="spell-count-num">0</span> spells</p>
      
      <div id="spells-list">
        <div class="loading">Loading spells...</div>
      </div>
    </section>

    <!-- MECHANICS SECTION -->
    <section id="mechanics" class="section">
      <h1 class="section-title">Game Mechanics</h1>
      <p class="section-subtitle">How the deep seas work</p>
      
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div class="card-icon blue">üé≤</div>
            <div>
              <div class="card-title">Dice System</div>
              <div class="card-subtitle">Roll for your fate</div>
            </div>
          </div>
          <div class="card-body">
            <p>Roll d20 + modifiers vs target numbers. Roll high for success. Natural 20 = critical success, natural 1 = critical failure.</p>
            <div class="card-traits">
              <span class="trait feature">d20 core</span>
              <span class="trait feature">Advantage/Disadvantage</span>
              <span class="trait feature">Critical hits</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon teal">üìä</div>
            <div>
              <div class="card-title">Ability Scores</div>
              <div class="card-subtitle">Six core attributes</div>
            </div>
          </div>
          <div class="card-body">
            <p>STR (melee), DEX (ranged/defense), CON (health), INT (arcane), WIS (divine), CHA (social). Higher = better. Modifiers affect all related rolls.</p>
            <div class="card-traits">
              <span class="trait stat">STR</span>
              <span class="trait stat">DEX</span>
              <span class="trait stat">CON</span>
              <span class="trait stat">INT</span>
              <span class="trait stat">WIS</span>
              <span class="trait stat">CHA</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon gold">‚ú®</div>
            <div>
              <div class="card-title">Magic System</div>
              <div class="card-subtitle">Tidal power</div>
            </div>
          </div>
          <div class="card-body">
            <p>Casters channel the ocean's magic through spell slots. Cantrips are unlimited. Leveled spells consume slots that refresh on rest. Upcast for more power.</p>
            <div class="card-traits">
              <span class="trait feature">Cantrips</span>
              <span class="trait feature">Spell slots</span>
              <span class="trait feature">Concentration</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon red">‚öîÔ∏è</div>
            <div>
              <div class="card-title">Combat</div>
              <div class="card-subtitle">Underwater warfare</div>
            </div>
          </div>
          <div class="card-body">
            <p>Take turns based on initiative. Each turn: move + action + bonus action (if available). Attack rolls vs AC. Spells may require saves.</p>
            <div class="card-traits">
              <span class="trait feature">Initiative</span>
              <span class="trait feature">Actions</span>
              <span class="trait feature">Attack vs AC</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon">ü¶û</div>
            <div>
              <div class="card-title">Lobster Traits</div>
              <div class="card-subtitle">Natural abilities</div>
            </div>
          </div>
          <div class="card-body">
            <p>Each lobster race has unique traits: darkvision, special resistances, innate abilities. Your shell is your identity.</p>
            <div class="card-traits">
              <span class="trait feature">Racial bonuses</span>
              <span class="trait feature">Special abilities</span>
              <span class="trait feature">Resistances</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon blue">üìà</div>
            <div>
              <div class="card-title">Progression</div>
              <div class="card-subtitle">Grow stronger</div>
            </div>
          </div>
          <div class="card-body">
            <p>Earn XP from encounters and quests. Level up to gain HP, new abilities, spell slots, and class features. Max level 20.</p>
            <div class="card-traits">
              <span class="trait feature">XP & Levels</span>
              <span class="trait feature">Class features</span>
              <span class="trait feature">Ability increases</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="hub-footer">
    <p>Caverns & Clawds ‚Äî An AI-powered tabletop adventure</p>
    <p><a href="/">Home</a> ¬∑ <a href="/api-docs.html">API Docs</a> ¬∑ <a href="/capstone.html">Play Demo</a></p>
  </footer>

  <script>
    // Navigation
    const navBtns = document.querySelectorAll('.nav-btn');
    const sections = document.querySelectorAll('.section');

    navBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const sectionId = btn.dataset.section;
        
        navBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        sections.forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
      });
    });

    // Data
    let allSpells = [];
    let allClasses = {};
    let allRaces = {};

    // Fetch data
    async function init() {
      try {
        // Fetch races
        const racesRes = await fetch('/api/character/races');
        const racesData = await racesRes.json();
        if (racesData.success && racesData.races) {
          // Convert array to object keyed by id
          allRaces = {};
          racesData.races.forEach(r => allRaces[r.id] = r);
        }
        
        // Fetch classes
        const classesRes = await fetch('/api/character/classes');
        const classesData = await classesRes.json();
        if (classesData.success && classesData.classes) {
          allClasses = {};
          classesData.classes.forEach(c => allClasses[c.id] = c);
        }
        
        renderClasses();
        renderRaces();
        
        // Fetch spells
        await loadSpells();
        
      } catch (err) {
        console.error('Failed to load data:', err);
        // Use fallback data
        loadFallbackData();
      }
    }

    async function loadSpells() {
      try {
        // Load from spells API
        const res = await fetch('/api/spells');
        if (res.ok) {
          const data = await res.json();
          allSpells = data.spells || [];
          // Convert range from hexes to feet for display
          allSpells = allSpells.map(s => ({
            ...s,
            rangeDisplay: s.range === 0 ? 'Self' : s.range === 1 ? 'Touch' : s.range === 999 ? 'Unlimited' : `${s.range * 5} ft`
          }));
        } else {
          allSpells = getEmbeddedSpells();
        }
      } catch {
        allSpells = getEmbeddedSpells();
      }
      
      document.getElementById('stat-spells').textContent = allSpells.length;
      renderSpells();
    }

    function getEmbeddedSpells() {
      // Embedded spell data for when API isn't available
      return [
        { id: 'thermalLance', name: 'Thermal Lance', level: 0, school: 'evocation', damage: '1d10', damageType: 'fire', description: 'You channel superheated water from a deep-sea vent, launching a scalding bolt at your target.', classes: ['tidecaller'] },
        { id: 'freezingCurrent', name: 'Freezing Current', level: 0, school: 'evocation', damage: '1d8', damageType: 'cold', description: 'A jet of arctic water from the polar depths streams toward your foe.', classes: ['tidecaller'] },
        { id: 'abyssalBeam', name: 'Abyssal Beam', level: 0, school: 'evocation', damage: '1d10', damageType: 'force', description: 'You draw power from the crushing depths, releasing a beam of pure pressure.', classes: ['depthtouched'] },
        { id: 'bioluminescentFlare', name: 'Bioluminescent Flare', level: 0, school: 'evocation', damage: '1d8', damageType: 'radiant', description: 'Divine light borrowed from the anglerfish descends upon your target.', classes: ['shellpriest'] },
        { id: 'cuttingRemark', name: 'Cutting Remark', level: 0, school: 'enchantment', damage: '1d4', damageType: 'psychic', description: 'Your insults cut deeper than any claw.', classes: ['shantysingerr'] },
        { id: 'pressureBarrage', name: 'Pressure Barrage', level: 1, school: 'evocation', damage: '3d4+3', damageType: 'force', description: 'Three concentrated bolts of crushing pressure streak toward your targets, impossible to dodge.', classes: ['tidecaller'] },
        { id: 'tidalMending', name: 'Tidal Mending', level: 1, school: 'evocation', healing: '1d8', description: 'Healing waters wash over a creature you touch, knitting wounds and restoring vitality.', classes: ['shellpriest', 'shantysingerr', 'crusader'] },
        { id: 'abyssalMark', name: 'Abyssal Mark', level: 1, school: 'enchantment', description: 'You brand a creature with a mark from the abyss. Your attacks tear at their very essence.', classes: ['depthtouched'] },
        { id: 'depthCharge', name: 'Depth Charge', level: 3, school: 'evocation', damage: '8d6', damageType: 'fire', description: 'A sphere of compressed heat detonates at a point you choose, flash-boiling everything in the area.', classes: ['tidecaller'] },
        { id: 'electricTorrent', name: 'Electric Torrent', level: 3, school: 'evocation', damage: '8d6', damageType: 'lightning', description: 'A devastating arc of bioelectric energy lances from your claw in a 100-foot line.', classes: ['tidecaller'] },
        { id: 'crushingDepths', name: 'Crushing Depths', level: 5, school: 'enchantment', description: 'The pressure of the hadal zone holds any creature motionless, regardless of their form.', classes: ['depthtouched', 'shantysingerr', 'tidecaller'] },
        { id: 'cataclysm', name: 'Cataclysm', level: 9, school: 'evocation', damage: '40d6', damageType: 'fire/bludgeoning', description: 'You call down the wrath of the primordial ocean‚Äîmassive spheres of devastation strike from above.', classes: ['tidecaller'] },
        { id: 'wordOfAnnihilation', name: 'Word of Annihilation', level: 9, school: 'enchantment', description: 'You speak a word of absolute power that snuffs out a creature\'s life force instantly.', classes: ['tidecaller', 'shantysingerr', 'depthtouched'] },
      ];
    }

    function loadFallbackData() {
      // Fallback class data
      allClasses = {
        fighter: { name: 'Shell Knight', seaName: 'Shell Knight', hitDie: 10, primaryStat: 'str', description: 'Master of martial combat. Armored in chitin and coral.' },
        rogue: { name: 'Shadow Swimmer', seaName: 'Shadow Swimmer', hitDie: 8, primaryStat: 'dex', description: 'Stealthy and deadly. Strikes from the murky depths.' },
        cleric: { name: 'Shellpriest', seaName: 'Shellpriest', hitDie: 8, primaryStat: 'wis', description: 'Divine caster. Channels the ocean\'s blessing.' },
        wizard: { name: 'Tidecaller', seaName: 'Tidecaller', hitDie: 6, primaryStat: 'int', description: 'Arcane master. Commands the forces of the deep.' },
        warlock: { name: 'Depthtouched', seaName: 'Depthtouched', hitDie: 8, primaryStat: 'cha', description: 'Pact magic wielder. Bargains with abyssal entities.' },
        paladin: { name: 'Crusader', seaName: 'Crusader', hitDie: 10, primaryStat: 'str', description: 'Holy warrior. Smites with divine wrath.' },
        bard: { name: 'Shantysingerr', seaName: 'Shantysingerr', hitDie: 8, primaryStat: 'cha', description: 'Performance magic. Songs that shape reality.' }
      };

      // Fallback race data
      allRaces = {
        american: { name: 'American Lobster', description: 'Classic red-brown lobster. Versatile and adaptable.', statBonuses: { str: 1, dex: 1, con: 1, int: 1, wis: 1, cha: 1 } },
        european: { name: 'European Lobster', description: 'Blue-tinged shell, elegant and magical.', statBonuses: { dex: 2, int: 1 } },
        slipper: { name: 'Slipper Lobster', description: 'Flat, wide shell. Stocky and tough.', statBonuses: { con: 2, wis: 1 } },
        spiny: { name: 'Spiny Lobster', description: 'No large claws, covered in defensive spines.', statBonuses: { str: 2, con: 1 } },
        reef: { name: 'Reef Lobster', description: 'Vibrant tropical colors. Boiling water breath.', statBonuses: { str: 2, cha: 1 } }
      };

      allSpells = getEmbeddedSpells();
      
      renderClasses();
      renderRaces();
      renderSpells();
      document.getElementById('stat-spells').textContent = allSpells.length;
    }

    // Render functions
    function renderClasses() {
      const grid = document.getElementById('classes-grid');
      const classCount = Object.keys(allClasses).length;
      document.getElementById('stat-classes').textContent = classCount || '5';
      const icons = { 
        fighter: '‚öîÔ∏è', rogue: 'üó°Ô∏è', cleric: '‚ú®', wizard: 'üîÆ', 
        warlock: 'üëÅÔ∏è', paladin: 'üõ°Ô∏è', bard: 'üéµ', ranger: 'üèπ' 
      };
      const colors = {
        fighter: 'red', rogue: '', wizard: 'blue', cleric: 'gold',
        warlock: '', paladin: 'gold', bard: 'teal', ranger: 'teal'
      };
      
      let html = '';
      for (const [id, cls] of Object.entries(allClasses)) {
        const displayName = cls.seaName || cls.name;
        html += `
          <div class="card">
            <div class="card-header">
              <div class="card-icon ${colors[id] || ''}">${icons[id] || 'ü¶û'}</div>
              <div>
                <div class="card-title">${displayName}</div>
                <div class="card-subtitle">d${cls.hitDie} hit die ¬∑ ${(cls.primaryStat || 'str').toUpperCase()} primary</div>
              </div>
            </div>
            <div class="card-body">
              <p>${cls.description}</p>
              ${cls.saveProficiencies ? `
                <div class="card-traits">
                  ${cls.saveProficiencies.map(s => `<span class="trait stat">${s.toUpperCase()} save</span>`).join('')}
                </div>
              ` : ''}
            </div>
          </div>
        `;
      }
      grid.innerHTML = html || '<p>No classes found</p>';
    }

    function renderRaces() {
      const grid = document.getElementById('races-grid');
      const raceCount = Object.keys(allRaces).length;
      document.getElementById('stat-races').textContent = raceCount || '10';
      const icons = {
        american: 'ü¶û', european: 'üíé', slipper: 'üõ°Ô∏è', squat: 'üçÄ',
        spiny: '‚öîÔ∏è', reef: 'üî•', pistol: 'üí•', calico: 'üé≠', ghost: 'üëª', split: 'üòà'
      };
      
      let html = '';
      for (const [id, race] of Object.entries(allRaces)) {
        const bonuses = race.statBonuses || {};
        const bonusStr = Object.entries(bonuses)
          .map(([stat, val]) => `+${val} ${stat.toUpperCase()}`)
          .join(', ');
        
        html += `
          <div class="card">
            <div class="card-header">
              <div class="card-icon">${icons[id] || 'ü¶û'}</div>
              <div>
                <div class="card-title">${race.name}</div>
                <div class="card-subtitle">${bonusStr || 'Balanced stats'}</div>
              </div>
            </div>
            <div class="card-body">
              <p>${race.description}</p>
              ${race.traits ? `
                <div class="card-traits">
                  ${race.traits.slice(0, 4).map(t => `<span class="trait feature">${t}</span>`).join('')}
                </div>
              ` : ''}
            </div>
          </div>
        `;
      }
      grid.innerHTML = html || '<p>No races found</p>';
    }

    function renderSpells() {
      const list = document.getElementById('spells-list');
      const levelFilter = document.getElementById('filter-level').value;
      const classFilter = document.getElementById('filter-class').value;
      const schoolFilter = document.getElementById('filter-school').value;
      
      let filtered = allSpells.filter(spell => {
        if (levelFilter !== 'all' && spell.level !== parseInt(levelFilter)) return false;
        if (classFilter !== 'all' && (!spell.classes || !spell.classes.includes(classFilter))) return false;
        if (schoolFilter !== 'all' && spell.school !== schoolFilter) return false;
        return true;
      });
      
      // Sort by level, then name
      filtered.sort((a, b) => {
        if (a.level !== b.level) return a.level - b.level;
        return a.name.localeCompare(b.name);
      });
      
      document.getElementById('spell-count-num').textContent = filtered.length;
      
      if (filtered.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: var(--text-dim); padding: 2rem;">No spells match your filters</p>';
        return;
      }
      
      let html = '';
      for (const spell of filtered) {
        const levelClass = spell.level === 0 ? 'cantrip' : `level-${spell.level}`;
        const levelText = spell.level === 0 ? 'Cantrip' : `Level ${spell.level}`;
        
        html += `
          <div class="spell-card" style="margin-bottom: 0.5rem;">
            <div class="spell-header" onclick="this.nextElementSibling.classList.toggle('open')">
              <span class="spell-name">${spell.name}</span>
              <span class="spell-level ${levelClass}">${levelText}</span>
            </div>
            <div class="spell-details">
              <div class="spell-meta">
                <div class="spell-meta-item">
                  <div class="spell-meta-label">School</div>
                  <div class="spell-meta-value">${spell.school || 'Unknown'}</div>
                </div>
                <div class="spell-meta-item">
                  <div class="spell-meta-label">Cast Time</div>
                  <div class="spell-meta-value">${spell.castingTime || '1 action'}</div>
                </div>
                ${spell.range !== undefined ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Range</div>
                    <div class="spell-meta-value">${spell.rangeDisplay || (spell.range === 0 ? 'Self' : spell.range * 5 + ' ft')}</div>
                  </div>
                ` : ''}
                ${spell.duration ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Duration</div>
                    <div class="spell-meta-value">${spell.duration}</div>
                  </div>
                ` : ''}
                ${spell.attackType ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Attack</div>
                    <div class="spell-meta-value">${spell.attackType} spell attack</div>
                  </div>
                ` : ''}
                ${spell.save ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Save</div>
                    <div class="spell-meta-value">${spell.save} save</div>
                  </div>
                ` : ''}
                ${spell.damage ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Damage</div>
                    <div class="spell-meta-value">${spell.damage} ${spell.damageType || ''}</div>
                  </div>
                ` : ''}
                ${spell.healing ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Healing</div>
                    <div class="spell-meta-value">${spell.healing}</div>
                  </div>
                ` : ''}
                ${spell.area && spell.area.shape !== 'single' ? `
                  <div class="spell-meta-item">
                    <div class="spell-meta-label">Area</div>
                    <div class="spell-meta-value">${spell.area.radius ? spell.area.radius * 5 + 'ft ' : ''}${spell.area.size ? spell.area.size * 5 + 'ft ' : ''}${spell.area.shape}</div>
                  </div>
                ` : ''}
              </div>
              ${spell.effect ? `<p class="spell-effect" style="color: #d4af37; margin-bottom: 0.5rem;"><strong>Effect:</strong> ${spell.effect}</p>` : ''}
              ${spell.upcast ? `<p class="spell-upcast" style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem;"><strong>Upcast:</strong> ${spell.upcast}</p>` : ''}
              <p class="spell-description">${spell.description || 'No description available.'}</p>
              ${spell.classes && spell.classes.length ? `
                <div class="spell-classes">
                  ${spell.classes.map(c => `<span class="spell-class">${c}</span>`).join('')}
                </div>
              ` : ''}
            </div>
          </div>
        `;
      }
      
      list.innerHTML = html;
    }

    // Filter event listeners
    document.getElementById('filter-level').addEventListener('change', renderSpells);
    document.getElementById('filter-class').addEventListener('change', renderSpells);
    document.getElementById('filter-school').addEventListener('change', renderSpells);

    // Initialize
    init();
  </script>
</body>
</html>
