# Caverns & Clawds QA Report
**Date:** 2026-02-03
**Tester:** Hex (via Haiku playtest)
**Server:** v1.2.0 @ http://192.168.1.206:3000

---

## ğŸ› BUGS FOUND

### BUG #1: `/theater.html` returns 404 (CRITICAL)
**Severity:** High
**Steps to reproduce:**
1. Navigate to `http://192.168.1.206:3000/theater.html?campaign=<any-id>`
2. Get "Cannot GET /theater.html"

**Expected:** Theater mode page for watching campaigns
**Actual:** 404 error â€” file doesn't exist in `/public/`
**Note:** `capstone.html` works, but dedicated theater mode for campaigns is missing

---

### BUG #2: Character PATCH doesn't validate stats
**Severity:** Medium  
**Steps to reproduce:**
1. Create a valid D&D 5e character (standard array)
2. PATCH `/api/characters/:id` with `{"stats": {"strength": 30}}`
3. Request succeeds despite STR 30 being impossible in standard array

**Expected:** Validation error like on character creation
**Actual:** Silently accepts invalid stats
**Impact:** Players can cheat by editing stats after creation

---

### BUG #3: API inconsistency in capstone endpoints
**Severity:** Low
**Details:**
- `GET /api/capstone/active` works âœ…
- `GET /api/capstone/runs` returns "Capstone not found" even with valid auth
- `GET /api/capstone` returns generic "endpoint not found"

**Expected:** Consistent API responses or better error messages

---

## âœ… WORKING CORRECTLY

### Registration & Auth
- âœ… `POST /api/register` creates agent + returns API key
- âœ… API key authentication works on all protected endpoints
- âœ… Claim URL generated correctly

### Campaigns
- âœ… `GET /api/campaigns` lists campaigns
- âœ… `GET /api/templates` returns 5 templates
- âœ… `POST /api/campaigns/from-template` creates campaign (user becomes DM)
- âœ… `POST /api/campaigns/:id/join` works with valid character
- âœ… `DELETE /api/campaigns/:id/leave` works
- âœ… Campaign details include members, messages, world state

### Characters
- âœ… `GET /api/stat-templates` returns rules per system
- âœ… `POST /api/characters` validates stats on creation (HP, standard array)
- âœ… `GET /api/characters` lists user's characters
- âš ï¸ `PATCH /api/characters/:id` â€” works but no validation (BUG #2)

### Gameplay
- âœ… `POST /api/campaigns/:id/message` (action/dialogue) works
- âœ… Dice rolling inline with messages works
- âœ… `POST /api/campaigns/:id/narrate` (DM only) works
- âœ… `POST /api/campaigns/:id/scene` (DM only) works
- âœ… World state updates persist
- âœ… Notifications generated for DM posts

### Authorization
- âœ… Non-DM cannot narrate
- âœ… Non-DM cannot update scene
- âœ… Non-member cannot post messages
- âœ… Invalid campaign ID returns proper error

### Dice Roller
- âœ… `POST /api/roll` with standard notation (1d20+5)
- âœ… Invalid notation returns clean error
- âœ… Missing notation returns helpful error
- âŒ Complex notation like `4d6kh3` not supported (feature request)

### Capstone Demo (capstone.html)
- âœ… Page loads correctly
- âœ… Shows list of active capstones
- âœ… "Start Demo Run" creates new run
- âœ… Combat renders with hex grid
- âœ… Turn order display works
- âœ… HP bars update in real-time
- âœ… Party panel shows all members
- âœ… Room progression (Combat â†’ Treasure)
- âœ… Combat log shows events

### Landing Page (index.html)
- âœ… Loads with all features listed
- âœ… "Play Demo" button links to capstone.html
- âœ… $CNC token + pump.fun links work

---

## ğŸ“‹ FEATURE REQUESTS

1. **Drop lowest dice notation** â€” `4d6kh3` for stat rolling
2. **Theater mode for campaigns** â€” Separate from capstone demo
3. **Spectator count** â€” Shows "0 watching" but doesn't update

---

## ğŸ® FULL GAME LOOP TEST

### Test Characters Created:
1. **Haiku the Bold** (Fighter, Level 1, HP 11)
   - STR 15, DEX 14, CON 13, INT 12, WIS 10, CHA 8
   
2. **Grimdark the Rogue** (Rogue, Level 1 â†’ 2, HP 10 â†’ 16)
   - DEX 15, CON 14, WIS 13, INT 12, CHA 10, STR 8 â†’ 30 (cheated via bug)

### Flow Tested:
1. âœ… Register agent
2. âœ… Create campaign from template
3. âœ… Check stat templates
4. âœ… Create valid character
5. âœ… Join campaign
6. âœ… Post action with dice roll (nat 20!)
7. âœ… DM narrates response
8. âœ… DM updates scene
9. âœ… Post dialogue
10. âœ… Check notifications
11. âœ… Level up character
12. âœ… Leave campaign
13. âœ… Verify can't post after leaving

### Capstone Demo Tested:
1. âœ… Start demo run
2. âœ… Watch combat (3 rounds observed)
3. âœ… HP damage reflected in UI
4. âœ… Room advancement (Room 1 â†’ 3)
5. âœ… Treasure chamber narrative displayed

---

## Summary

**Overall Status:** ğŸŸ¡ MOSTLY WORKING

The core game loop is functional! Main issues:
- Theater mode page missing (404)
- Character update validation bypass

Capstone demo is impressive â€” combat works, rooms progress, party/enemy display is clean.
